{{/* layouts/partials/head.html */}}
<!-- debug -->

<div class="header">
  <div class="header-top">
    <div class="site-brand">
      <a class="site-brand__logoLink" href="{{ relLangURL "" }}" aria-label="{{ .Site.Title }}">
        <img class="site-brand__logo" src="{{ relURL "img/maeka_logo.png" }}" alt="{{ .Site.Title }}" loading="eager">
      </a>

      <div class="site-brand__text">
        <h1 class="site-brand__title">
          <a class="site-brand__titleLink" href="{{ relLangURL "" }}">{{ .Site.Title }}</a>
        </h1>
        {{ with .Site.Params.description }}
          <!--p class="site-subtitle">{{ . }}</p-->
        {{ end }}
      </div>
    </div>

    <div class="site-description">
      <nav class="nav social" aria-label="Social">
        <ul class="flat">
          {{- range $index, $key := .Site.Params.Social -}}
            <li><a href="{{ $key.url }}" title="{{ $key.name }}"><i data-feather="{{ $key.icon }}"></i></a></li>
          {{- end -}}

          {{- if or (eq .Site.Params.mode "auto") (eq .Site.Params.mode "dark") -}}
            <span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></span>
          {{- end -}}
        </ul>
      </nav>
    </div>
  </div>

  {{/* TRUE somente em /posts/ e /posts/<subsection>/ (listas). Nunca em single. */}}
  {{ $isPostsList := and (eq .Section "posts") .IsNode }}

  <div class="header-navwrap">
    <nav class="nav" aria-label="Main navigation">
      <ul class="flat">
        {{ range .Site.Menus.main }}
          {{/* Mantém o ativo padrão do Hugo + força ativo em /posts/ para o item "posts" */}}
          {{ $active := or
              ($.IsMenuCurrent "main" .)
              ($.HasMenuCurrent "main" .)
              (and $isPostsList (eq .Identifier "posts"))
          }}
          <li>
            <a class="{{ if $active }}active{{ end }}" href="{{ .URL | relLangURL }}">{{ .Name }}</a>
          </li>
        {{ end }}

        {{ if .IsTranslated }}
          {{ range .Translations }}
            <li><a href="{{ .Permalink }}">{{ .Language.LanguageName }}</a></li>
          {{ end }}
        {{ end }}
      </ul>
    </nav>

    {{/* Subnav de categorias: só em /posts/ e /posts/<subsection>/ */}}
    {{ $postsSection := .Site.GetPage "section" "posts" }}
    {{ if and $postsSection $isPostsList }}
      <details class="nav-categories__details" id="nav-categories-details" open>
        <summary class="nav-categories__summary">
          {{ i18n "categories" }}
        </summary>
        {{ if and (eq .Section "posts") (ne .Kind "page") }}
          <nav class="nav nav-categories" aria-label="{{ i18n "categories" }}">
            <ul class="flat">
              {{ range $postsSection.Sections.ByTitle }}
                {{ $isActive := eq .RelPermalink $.RelPermalink }}
                <li>
                  <a class="{{ if $isActive }}active{{ end }}" href="{{ .RelPermalink }}">{{ .Title }}</a>
                </li>
              {{ end }}
            </ul>
          </nav>
        {{ end }}
      </details>

      <script>
        (function () {
          const details = document.getElementById("nav-categories-details");
          if (!details) return;

          function sync() {
            if (window.matchMedia("(max-width: 350px)").matches) {
              details.removeAttribute("open"); // vira dropdown
            } else {
              details.setAttribute("open", ""); // vira “linha normal”
            }
          }

          sync();
          window.addEventListener("resize", sync, { passive: true });
        })();
      </script>
    {{ end }}
  </div>
</div>
